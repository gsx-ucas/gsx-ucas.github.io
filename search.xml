<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>CUT&amp;Tag 上游分析流程</title>
    <url>/2023/06/10/CutTag-upstream-analysis/</url>
    <content><![CDATA[<blockquote>
<p>代码参考<a href="https://yezhengstat.github.io/CUTTag_tutorial/#VII_Visualization">cuttag文章分析流程推荐的代码</a>，基于自己的数据和理解，对部分分析内容做了改动。</p>
<p><strong>需要用到的软件如下：</strong></p>
<ul>
<li>fastp: 去接头，生成质控报告</li>
<li>bowtie2: 比对测序数据到基因组</li>
<li>samtools&#x2F;sambamba: 处理比对后的bam&#x2F;sam文件，例如排序（sort）和去重（markdup）等</li>
<li>bedtools: 用大肠杆菌的基因组进行校准(Spike-in calibration)</li>
<li>MACS2: 进行peak calling，原流程还推荐了SEACR</li>
<li>homer: 对peak进行注释距离最近的基因、外显子、内含子、转录起始位点、基因间区等。</li>
</ul>
<p><strong>需要用到的数据如下：</strong></p>
<ul>
<li>参考基因组：可以从<a href="https://www.ncbi.nlm.nih.gov/genome/">NCBI</a>, <a href="https://asia.ensembl.org/info/data/ftp/index.html">ENSEMBL</a> 和 <a href="https://hgdownload.soe.ucsc.edu/downloads.html">UCSC</a> 三个数据库下载到。</li>
<li>大肠杆菌基因组：官网推荐要用大肠杆菌的基因组进行校准, 可从<a href="https://www.ncbi.nlm.nih.gov/genome?term=DH5alpha&cmd=DetailsSearch">NCBI</a>进行下载</li>
<li>blacklist_region: <a href="https://github.com/Boyle-Lab/Blacklist/tree/master/lists">基因组黑名单区域</a>，这些区域在多种NGS测序数据中产生异常信号值，影响数据结果。因此进行peak calling之后需要将这些区域去除。</li>
<li>chromsize file: 记录基因组染色体大小的文件，这个文件可以在UCSC数据库中下载到，如人的基因组对应的该文件<a href="https://hgdownload.soe.ucsc.edu/goldenPath/hg38/bigZips/">hg38.chrom.sizes</a></li>
</ul>
</blockquote>
<h2 id="Reads去接头"><a href="#Reads去接头" class="headerlink" title="Reads去接头"></a>Reads去接头</h2><p>在<a href="https://yezhengstat.github.io/CUTTag_tutorial/#311_Alignment_to_HG38">原教程中</a>提到 <em>There is no need to trim reads from out standard 25x25 PE sequencing, as adapter sequences will not be included in reads of inserts &gt;25 bp. However, for users performing longer sequencing, reads will need to be trimmed by Cutadapt and mapped by <code>--local --very-sensitive --no-mixed --no-discordant --phred33 -I 10 -X 700</code> to ignore any remaining adapter sequence at the 3’ ends of reads during mapping.</em> </p>
<p>其意思是说对于PE25(reads长度为25的双端测序数据)，插入片段大多会大于25bp，所以不会有大量的接头序列存在，因此才不需要进行去接头的操作。另外，指定比对参数<code>--local</code>后bowtie2进行局部比对，这种模式下bowtie2会从比对的reads一端或者两端修剪掉那些不能比对的碱基，从而最大化比对分数。具体的解释可以参考原教程作者在<a href="https://github.com/yezhengSTAT/CUTTag_tutorial/issues/3#issuecomment-841950393">github issue</a>中的回复。另外，教程作者也提到，可以尝试常用的ChIP-seq数据的比对方法，比较看一下哪种比对率更合理。</p>
<p><strong>以我的理解</strong> 1. 长测序reads比如PE150，最好还是先执行去接头的操作，然后再进行比对。2. 只要比对率能够接受，用常用的比对参数进行比对也是可以的。<br>去接头的软件我推荐<a href="https://github.com/OpenGene/fastp">fastp</a>, 一是它去的干净且能够自动检测接头序列，二是它的速度真的很快。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 以下代码利用snakemake进行流程控制，具体规则可参考[snakemake文档](https://snakemake.readthedocs.io/en/stable/)。</span></span><br><span class="line">input:</span><br><span class="line">    r1=<span class="string">&#x27;SeqData/LR/CD8_BCL11B_CUTTag/&#123;samples&#125;_R1.fastq.gz&#x27;</span>,</span><br><span class="line">    r2=<span class="string">&#x27;SeqData/LR/CD8_BCL11B_CUTTag/&#123;samples&#125;_R2.fastq.gz&#x27;</span></span><br><span class="line">output:</span><br><span class="line">    r1=<span class="string">&#x27;Trim/&#123;samples&#125;_R1.fq.gz&#x27;</span>,</span><br><span class="line">    r2=<span class="string">&#x27;Trim/&#123;samples&#125;_R2.fq.gz&#x27;</span></span><br><span class="line">shell:</span><br><span class="line">    <span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">        fastp -w 10 \</span></span><br><span class="line"><span class="string">        --compression=2 \</span></span><br><span class="line"><span class="string">        --detect_adapter_for_pe \</span></span><br><span class="line"><span class="string">        -i &#123;input.r1&#125; \</span></span><br><span class="line"><span class="string">        -I &#123;input.r2&#125; \</span></span><br><span class="line"><span class="string">        -o &#123;output.r1&#125; \</span></span><br><span class="line"><span class="string">        -O &#123;output.r2&#125; \</span></span><br><span class="line"><span class="string">        -h Trim/&#123;wildcards.samples&#125;.html \</span></span><br><span class="line"><span class="string">        -j Trim/&#123;wildcards.samples&#125;.json</span></span><br><span class="line"><span class="string">    &#x27;</span><span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="Reads比对至基因组"><a href="#Reads比对至基因组" class="headerlink" title="Reads比对至基因组"></a>Reads比对至基因组</h2><p>这一步将进行两次比对，首先将reads比对到参考基因组(如人的hg38，小鼠的mm10)，然后将reads比对到大肠杆菌基因组. <a href="https://yezhengstat.github.io/CUTTag_tutorial/#V_Spike-in_calibration">原教程中</a>提到<em>E. coli DNA is carried along with bacterially-produced pA-Tn5 protein and gets tagmented non-specifically during the reaction.</em> 因为在建库的过程中使用的重组蛋白A&#x2F;G-MNase残留有大肠杆菌DNA，假设一系列样本，每个样本使用相同数量的细胞，那么比对到到参考基因组的reads与大肠杆菌基因组的比例是相同的。因此，可以通过计算比对到大肠杆菌基因组的reads比例来进行比对信号的标准化。</p>
<h3 id="建立基因组index"><a href="#建立基因组index" class="headerlink" title="建立基因组index"></a>建立基因组index</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 建立人基因组参考hg38的index</span></span><br><span class="line">bowtie2-build hg38.chrom.fasta hg38_bt2index/genome</span><br><span class="line"><span class="comment"># 建立大肠杆菌E.coli的index</span></span><br><span class="line">bowtie2-build E.coli.fasta E.coli_bt2index/genome</span><br></pre></td></tr></table></figure>

<h3 id="Reads比对到参考基因组"><a href="#Reads比对到参考基因组" class="headerlink" title="Reads比对到参考基因组"></a>Reads比对到参考基因组</h3><p>目前常用的人类参考基因组是hg38，但是hg38版本的参考基因组有很多未知位置的基因组片段(alternative contigs, 例如)，建议将这些序列去除，只用常规染色体(chr1..chr22, chX, chrY)进行分析。否则，reads可能不是唯一比对，因此将被分配低比对质量分数。<a href="https://www.biostars.org/p/342482/">Biostars</a>上有关于这个问题的讨论。其他物种如果有同样的情况，建议也这样做。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rule bowtie2:</span><br><span class="line">input:</span><br><span class="line">    r1=<span class="string">&#x27;Trim/&#123;samples&#125;_R1.fq.gz&#x27;</span>,</span><br><span class="line">    r2=<span class="string">&#x27;Trim/&#123;samples&#125;_R2.fq.gz&#x27;</span></span><br><span class="line">output:</span><br><span class="line">    bam = <span class="string">&#x27;Mapping/&#123;samples&#125;.bam&#x27;</span>,</span><br><span class="line">    <span class="built_in">sum</span> = <span class="string">&#x27;Mapping/&#123;samples&#125;_aln_sum.txt&#x27;</span></span><br><span class="line">shell:</span><br><span class="line">    <span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">        bowtie2 -X 700 -p 10 --end-to-end --very-sensitive \</span></span><br><span class="line"><span class="string">        --no-mixed --no-discordant --phred33 -I 10 \</span></span><br><span class="line"><span class="string">        -x hg38_bt2index/genome \</span></span><br><span class="line"><span class="string">        -1 &#123;input.r1&#125; \</span></span><br><span class="line"><span class="string">        -2 &#123;input.r2&#125; \</span></span><br><span class="line"><span class="string">        2&gt; &#123;output.sum&#125; | \ # 将比对记录导出</span></span><br><span class="line"><span class="string">        samtools view -@ 10 -ShuF 4 -f 2 -q 20 - | \ # 剔除未比对的reads(-F 4)，保留双端比对同时比对质量大于20的reads(-f 2 -q 20)</span></span><br><span class="line"><span class="string">        samtools sort -@ 10 -n - -o &#123;output.bam&#125; # 对序列进行排序，默认按坐标排序</span></span><br><span class="line"><span class="string">    &#x27;</span><span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>—————————————————————————- 未完待续 ————————————————————————</p>
]]></content>
      <categories>
        <category>Analysis Tutorial</category>
      </categories>
      <tags>
        <tag>CUT&amp;Tag</tag>
        <tag>Chromatin</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2023/06/13/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
  </entry>
</search>
